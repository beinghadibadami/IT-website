# HDFC Smart Gateway Payment API Documentation

This document provides details on how to use the `hdfc_payment.php` API endpoint to initiate payments via the HDFC Smart Gateway.

## Endpoint Overview

- **URL**: `/api/hdfc_payment.php`
- **Method**: `POST`
- **Content-Type**: `application/x-www-form-urlencoded` or `multipart/form-data` (standard form submission)

## Description

This API endpoint initiates a payment order with HDFC Smart Gateway. It accepts customer details and transaction amount, creates an order on the HDFC gateway, and returns a payment link or redirects the user to the payment page.

## Request Parameters

The API expects the following parameters in the `POST` body:

| Parameter     | Type   | Required | Description                                      |
| :------------ | :----- | :------- | :----------------------------------------------- |
| `name`        | String | **Yes**  | Full name of the customer.                       |
| `email`       | String | **Yes**  | Email address of the customer.                   |
| `phone`       | String | **Yes**  | Phone number of the customer.                    |
| `amount`      | Float  | **Yes**  | Transaction amount (e.g., `100.00`).             |
| `description` | String | No       | Optional description of the payment. Default: "Payment For Order" |

### Example Request Body
```
name=John Doe
email=john.doe@example.com
phone=9876543210
amount=500.00
description=Service Charge
```

## Response Behavior

The API behaves differently based on the request headers, specifically `Accept` and `X-Requested-With`.

### 1. JSON Response (AJAX / API Usage)

If the request is made via AJAX (Header `X-Requested-With: xmlhttprequest`) OR the `Accept` header does not primarily prefer `text/html`, the API returns a JSON response.

**Success Response (200 OK):**
```json
{
  "success": true,
  "payment_link": "https://smartgateway.hdfcbank.com/payment/...",
  "order_id": "ORDER_1234567890"
}
```

**Error Response (400 Bad Request / 405 Method Not Allowed / 500 Internal Error):**
```json
{
  "success": false,
  "error": "Error message description",
  "response": { ... } // Optional raw response from gateway if available
}
```

### 2. Automatic Redirect (Browser Form Submission)

If the request is a standard browser form submission (Header `Accept` includes `text/html` and NOT an AJAX request), the API will automatically redirect the user to the `payment_link` upon success.

## Error Codes

- **405 Method Not Allowed**: If the request method is not `POST`.
- **400 Bad Request**: If required fields (`name`, `email`, `phone`, `amount`) are missing.
- **500 Internal Server Error**: If the HDFC Gateway fails to create an order.

## Usage Examples

### cURL Example
```bash
curl -X POST https://yourdomain.com/api/hdfc_payment.php \
  -d "name=Test User" \
  -d "email=test@example.com" \
  -d "phone=9999999999" \
  -d "amount=10.00" \
  -d "description=Test Payment"
```

### HTML Form Example
```html
<form action="/api/hdfc_payment.php" method="POST">
    <input type="text" name="name" placeholder="Name" required>
    <input type="email" name="email" placeholder="Email" required>
    <input type="tel" name="phone" placeholder="Phone" required>
    <input type="number" name="amount" placeholder="Amount" step="0.01" required>
    <button type="submit">Pay Now</button>
</form>
```

## Notes
- The `order_id` is automatically generated by the backend if not provided.
- Ensure your `HDFCSmartGateway` class is correctly configured in `includes/hdfc_smart_gateway.php`.
